{% extends 'admin_temp/base.html' %}
{% block content %}

<main id="main" class="main">
    <div class="container mt-5 mb-5">
        <div class="row">
            <div class="col-md-6">
                <h4 style="text-align: end; padding-right: 10px"></h4>
                <input type="hidden" id="user-id" value="{{ user_id }}">
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body p-4">
                        <b>{{ thread.first_person }}</b>
                        <input class="thread-id-input" type="hidden" value="{{ thread.id }}">
                        <a href="">View Chat</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notification container -->
        <div id="notification-container" class="mt-3"></div>
    </div>
</main>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    // Obtain the user ID from the hidden input field
    const userId = document.getElementById('user-id').value;

    // WebSocket connection
    //console.log('User ID:', userId);
    const userChannel = new WebSocket(`ws://127.0.0.1:8000/ws/chat/${userId}/`);  

    // Notification container
    let notificationContainer = document.getElementById('notification-container');

    userChannel.onmessage = function (e) {
        let notificationData = JSON.parse(e.data);

        // Create a customized notification element
        let notificationElement = document.createElement('div');
        notificationElement.className = 'custom-notification';
        notificationElement.innerHTML = `
            <div class="alert alert-info" role="alert">
                <strong>New Message</strong> from ${notificationData.senderUsername}: ${notificationData.message}
            </div>
        `;

        // Append the notification to the container
        notificationContainer.appendChild(notificationElement);

        // Remove the notification after a certain time (e.g., 5 seconds)
        setTimeout(function () {
            notificationContainer.removeChild(notificationElement);
        }, 5000); // Adjust the time as needed
    };
</script>

{% endblock content %}
